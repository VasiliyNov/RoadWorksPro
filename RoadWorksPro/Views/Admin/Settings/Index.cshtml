@model RoadWorksPro.Models.ViewModels.SettingsViewModel
@{
    ViewData["Title"] = "Налаштування системи";
    Layout = "_AdminLayout";
}

@if (TempData["Success"] != null)
{
    <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4" role="alert">
        <span class="block sm:inline">@TempData["Success"]</span>
    </div>
}
@if (TempData["Error"] != null)
{
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4" role="alert">
        <span class="block sm:inline">@TempData["Error"]</span>
    </div>
}

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    @* Email Settings *@
    <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-xl font-semibold mb-4">Налаштування Email</h2>

        <div class="space-y-4">
            <div class="bg-blue-50 border border-blue-200 rounded p-3">
                <p class="text-sm text-blue-800">
                    <strong>Для Gmail:</strong><br>
                    1. Увімкніть двофакторну аутентифікацію<br>
                    2. Створіть пароль додатку: myaccount.google.com/apppasswords<br>
                    3. Використовуйте цей пароль замість звичайного
                </p>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">SMTP Сервер</label>
                <input type="text" value="@Model.SmtpHost" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-lg" readonly>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">SMTP Порт</label>
                <input type="text" value="@Model.SmtpPort" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-lg" readonly>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">Email для відправки</label>
                <input type="text" value="@Model.SmtpUser" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50" readonly>
                <p class="text-xs text-gray-500 mt-1">Налаштовується в appsettings.json</p>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">Email адміністраторів (через кому)</label>
                <input type="text" value="@Model.AdminEmails" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50" readonly>
            </div>
        </div>

        <div class="mt-6">
            <h3 class="font-semibold mb-3">Тестування Email</h3>
            <form method="post" action="/Admin/Settings/TestEmail" class="flex gap-2">
                @Html.AntiForgeryToken()
                <input type="email"
                       name="email"
                       placeholder="test@example.com"
                       required
                       class="flex-1 px-3 py-2 border border-gray-300 rounded-lg">
                <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition">
                    Тест
                </button>
            </form>
        </div>
    </div>

    @* System Info *@
    <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-xl font-semibold mb-4">Інформація про систему</h2>

        <dl class="space-y-3">
            <div class="flex justify-between">
                <dt class="text-gray-500">Версія .NET:</dt>
                <dd class="font-medium">@Environment.Version</dd>
            </div>
            <div class="flex justify-between">
                <dt class="text-gray-500">Операційна система:</dt>
                <dd class="font-medium">@Environment.OSVersion</dd>
            </div>
            <div class="flex justify-between">
                <dt class="text-gray-500">Час сервера (UTC):</dt>
                <dd class="font-medium">@DateTime.UtcNow.ToString("dd.MM.yyyy HH:mm:ss")</dd>
            </div>
            <div class="flex justify-between">
                <dt class="text-gray-500">Час сервера (Київ):</dt>
                <dd class="font-medium">@DateTime.UtcNow.AddHours(2).ToString("dd.MM.yyyy HH:mm:ss")</dd>
            </div>
            <div class="flex justify-between">
                <dt class="text-gray-500">Культура:</dt>
                <dd class="font-medium">@System.Globalization.CultureInfo.CurrentCulture.Name</dd>
            </div>
        </dl>

        <div class="mt-6 p-4 bg-yellow-50 rounded-lg">
            <h3 class="font-semibold mb-2">Конфігурація в appsettings.json:</h3>
            <pre class="text-xs bg-gray-100 p-2 rounded overflow-x-auto">
"Email": {
  "SmtpHost": "smtp.gmail.com",
  "SmtpPort": 587,
  "SmtpUser": "your-email@gmail.com",
  "SmtpPassword": "your-app-password",
  "SenderName": "РоадПро",
  "SenderEmail": "your-email@gmail.com",
  "AdminNotificationEmails": "vakawelli@gmail.com"
}</pre>
        </div>
    </div>
</div>

@* Instructions *@
<div class="mt-6 bg-white rounded-lg shadow p-6">
    <h2 class="text-xl font-semibold mb-4">Інструкція по налаштуванню</h2>

    <div class="prose max-w-none">
        <h3 class="text-lg font-semibold mb-2">Для налаштування email:</h3>
        <ol class="list-decimal list-inside space-y-2 text-gray-700">
            <li>Відкрийте файл <code class="bg-gray-100 px-1 rounded">appsettings.json</code> в корені проекту</li>
            <li>Додайте секцію "Email" з вашими даними</li>
            <li>Для Gmail: використовуйте пароль додатку, не основний пароль</li>
            <li>Перезапустіть додаток після зміни налаштувань</li>
        </ol>

        <h3 class="text-lg font-semibold mb-2 mt-4">Telegram уведомления (опционально):</h3>
        <ol class="list-decimal list-inside space-y-2 text-gray-700">
            <li>Створіть бота через @@BotFather в Telegram</li>
            <li>Отримайте токен бота</li>
            <li>Дізнайтесь свій Chat ID через @@userinfobot</li>
            <li>Додайте в appsettings.json секцію "Telegram"</li>
        </ol>
    </div>
</div>